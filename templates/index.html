<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Road Anomaly Detection Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/Style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script>
        // Global error handler for Socket.IO
        window.addEventListener('error', function(e) {
            if (e.message.includes('socket.io') || e.message.includes('websocket')) {
                console.error('Socket.IO error:', e);
                const statusElement = document.getElementById('uploadStatus');
                if (statusElement) {
                    statusElement.innerText = 'Connection error. Please refresh the page.';
                    statusElement.className = 'status-message error';
                }
            }
        });
    </script>
</head>
<body>
    <!-- Dynamic Background Slideshow -->
    <div class="background-slideshow">
        <div class="bg-image default-bg active" id="defaultBg"></div>
        <div class="bg-image upload-bg" id="uploadBg"></div>
        <div class="bg-image arduino-bg" id="arduinoBg"></div>
        <div class="bg-image analytics-bg" id="analyticsBg"></div>
    </div>
    
    <!-- Floating Elements for Enhanced Visual Appeal -->
    <div class="floating-elements"></div>

    <div class="dashboard">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h2 class="text-glow">RoadGuard AI</h2>
                <p style="font-size: 12px; color: rgba(255,255,255,0.7); margin-top: 5px;">Intelligent Road Monitoring</p>
            </div>
            <nav>
                <ul>
                    <li class="active"><a href="#upload-section">ðŸ“¦ Video Upload</a></li>
                    <li><a href="#arduino-section">ðŸ“· Arduino Feed</a></li>
                    <li><a href="#analytics-section">ðŸ“Š Analytics</a></li>
                </ul>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <header>
                <h1>Road Anomaly Detection Dashboard</h1>
                <div class="header-stats">
                    <div class="stat-card pulse-glow">
                        <span class="stat-value" id="totalDetections">0</span>
                        <span class="stat-label">Total Detections</span>
                    </div>
                    <div class="stat-card pulse-glow">
                        <span class="stat-value" id="currentFPS">0</span>
                        <span class="stat-label">Current FPS</span>
                    </div>
                    <div class="stat-card pulse-glow">
                        <span class="stat-value" id="systemStatus">ðŸŸ¢</span>
                        <span class="stat-label">System Status</span>
                    </div>
                </div>
            </header>

            <!-- Upload Section -->
            <section id="upload-section" class="dashboard-section animated-border">
                <div class="section-header">
                    <h2>ðŸ“¦ Video Upload & Detection</h2>
                    <div class="upload-controls">
                        <input type="file" id="videoInput" accept="video/*" class="file-input">
                        <button id="uploadBtn" class="primary-button">ðŸš€ Upload & Detect</button>
                    </div>
                    <div class="fps-controls" style="margin-top:10px;">
                        <label style="color: rgba(255,255,255,0.8); margin-right: 10px;">Target FPS:</label>
                        <input type="number" id="desiredFPS" min="1" max="60" value="30" style="width: 70px; padding: 8px; border-radius: 5px; border: 1px solid rgba(59,130,246,0.3); background: rgba(30,58,138,0.2); color: white;">
                        <button id="setFPSBtn" class="primary-button">âš¡ Set FPS</button>
                    </div>
                </div>
                <div class="video-grid">
                    <div class="video-card">
                        <h3>Original Video</h3>
                        <div class="video-container">
                            <video id="originalVideo" controls autoplay muted></video>
                        </div>
                    </div>
                    <div class="video-card">
                        <h3>Detection Results</h3>
                        <div class="video-container">
                            <img id="processedImage" src="" alt="Detection Results">
                        </div>
                    </div>
                </div>
                <div id="uploadStatus" class="status-message"></div>
            </section>

            <!-- Arduino Section -->
            <section id="arduino-section" class="dashboard-section animated-border">
                <div class="section-header">
                    <h2>ðŸ“· Arduino Real-Time Detection</h2>
                    <button id="arduinoBtn" class="primary-button">
                        ðŸŽ¥ Start Arduino Feed
                    </button>
                    <div style="margin-top: 10px; font-size: 14px; color: rgba(255,255,255,0.7);">
                        <span>ðŸ“¡ Real-time processing with live camera feed</span>
                    </div>
                </div>
                <div class="arduino-grid">
                    <div class="video-card">
                        <h3>Live Feed</h3>
                        <div class="video-container">
                            <img id="liveOriginal" src="" alt="Live Feed">
                        </div>
                    </div>
                    <div class="video-card">
                        <h3>Detection Results</h3>
                        <div class="video-container">
                            <img id="liveDetection" src="" alt="Live Detection">
                        </div>
                    </div>
                </div>
                <div id="arduino-status" class="status-message"></div>
            </section>

            <!-- Analytics Section -->
            <section id="analytics-section" class="dashboard-section animated-border">
                <div class="section-header">
                    <h2>ðŸ“Š Detection Analytics</h2>
                </div>
                <div class="analytics-grid">
                    <div class="chart-card">
                        <h3>Detection Confidence</h3>
                        <canvas id="confidenceChart"></canvas>
                    </div>
                    <div class="log-card">
                        <h3>Detection Log</h3>
                        <div id="detectionLog" class="log-container"></div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
